<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Amministratore Sito ‚Äì Condominio Piazza Guala ‚Äì Via Piobesi</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="admin-sito">
  <header class="dash-header admin-sito">
    <h1><i data-lucide="shield"></i> Dashboard Amministratore Sito</h1>
    <button id="logout">Esci</button>
  </header>

  <!-- NAVIGAZIONE E BREADCRUMB -->
  <nav class="breadcrumb-bar">
    <div class="breadcrumb-left">
      <a href="../index.html" class="home-link">üè† Home</a>
      <span id="breadcrumb-path"></span>
    </div>
    <button id="exit-button">üîë Esci</button>
  </nav>

  <main class="dashboard">

    <!-- SEZIONE STATISTICHE -->
    <div class="card wide">
      <h2><i data-lucide="activity"></i> Statistiche del portale</h2>
      <canvas id="statsChart"></canvas>
    </div>

    <!-- SEZIONE BACKUP -->
    <div class="card">
      <h2><i data-lucide="database"></i> Backup del sito</h2>
      <p>Avvia un salvataggio completo dei dati e dei file.</p>
      <button id="backupBtn">Avvia backup</button>
      <div id="backupProgress" class="progress-bar"><div class="progress"></div></div>
      <p id="backupStatus" class="status"></p>
    </div>

    <!-- SEZIONE SICUREZZA -->
    <div class="card">
      <h2><i data-lucide="lock"></i> Sicurezza</h2>
      <p>Monitoraggio in tempo reale dello stato del sito.</p>
      <div class="security-status">
        <div class="status-box green">üü¢ Sistema protetto</div>
        <div class="status-box yellow">üü° Firewall in aggiornamento</div>
        <div class="status-box red">üî¥ Nessuna minaccia rilevata</div>
      </div>
    </div>

    <!-- SEZIONE GESTIONE CONTENUTI -->
    <div class="card wide">
      <h2><i data-lucide="edit-3"></i> Gestione contenuti e comunicazioni</h2>
      <textarea id="newPost" placeholder="Scrivi un nuovo annuncio o aggiornamento..."></textarea>
      <button id="publishBtn">Pubblica</button>
      <ul id="postList"></ul>
    </div>

    <!-- SEZIONE DOCUMENTI -->
    <div class="card wide">
      <h2><i data-lucide="file-plus"></i> Documenti condivisi</h2>
      <p>Carica o visualizza i documenti condominiali.</p>
      <input type="file" id="uploadFile" multiple />
      <ul id="fileList"></ul>
    </div>

  </main>

  <footer>
    <p>&copy; 2025 Condominio Piazza Guala ‚Äì Via Piobesi</p>
  </footer>

  <script src="../js/dashboard.js"></script>
  <script>
    lucide.createIcons();

    // ===== GRAFICO VISITE =====
    const ctx = document.getElementById("statsChart");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Dom"],
        datasets: [{
          label: "Visite giornaliere",
          data: [5, 7, 9, 14, 12, 15, 20],
          borderColor: "#00a8ff",
          tension: 0.4,
          fill: { target: "origin", above: "rgba(0,168,255,0.15)" }
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, grid: { color: "rgba(255,255,255,0.2)" } },
          x: { grid: { display: false } }
        }
      }
    });

    // ===== BACKUP SIMULATO =====
    const backupBtn = document.getElementById("backupBtn");
    const progressBar = document.querySelector(".progress");
    const backupStatus = document.getElementById("backupStatus");

    backupBtn.addEventListener("click", () => {
      let progress = 0;
      backupBtn.disabled = true;
      progressBar.style.width = "0%";
      backupStatus.textContent = "üîÑ Backup in corso...";

      const interval = setInterval(() => {
        progress += 5;
        progressBar.style.width = progress + "%";
        if (progress >= 100) {
          clearInterval(interval);
          backupStatus.textContent = "‚úÖ Backup completato con successo!";
          backupBtn.disabled = false;
        }
      }, 150);
    });

   // ===== GESTIONE CONTENUTI (con salvataggio locale) =====
const publishBtn = document.getElementById("publishBtn");
const postList = document.getElementById("postList");

// Carica eventuali post salvati
const savedPosts = JSON.parse(localStorage.getItem("posts") || "[]");
savedPosts.forEach(text => addPost(text));

publishBtn.addEventListener("click", () => {
  const text = document.getElementById("newPost").value.trim();
  if (text === "") return alert("Scrivi qualcosa da pubblicare!");
  addPost(text);
  savedPosts.unshift(text);
  localStorage.setItem("posts", JSON.stringify(savedPosts));
  document.getElementById("newPost").value = "";
});

function addPost(text) {
  const li = document.createElement("li");
  li.innerHTML = `<i data-lucide="message-square"></i> ${text}`;
  postList.prepend(li);
  lucide.createIcons();
}


    // ===== UPLOAD DOCUMENTI =====
    const uploadInput = document.getElementById("uploadFile");
    const fileList = document.getElementById("fileList");

    uploadInput.addEventListener("change", (e) => {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        const li = document.createElement("li");
        li.innerHTML = `<i data-lucide="file"></i> ${file.name} <span style="color:#00a8ff;">(simulato)</span>`;
        fileList.appendChild(li);
      });
      lucide.createIcons();
    });
  </script>
</body>
</html>
